<html>
    <head>
        <title>WebSocket Remote Game Controller</title>
    </head>
    <body>
        <script type="text/javascript">
            var websocket = null;
            try {
                if (typeof MozWebSocket == 'function')
                    WebSocket = MozWebSocket;
                var wsUri = window.location.protocol.replace('http', 'ws') + '//' + window.location.host
                websocket = new WebSocket( wsUri );
                websocket.onopen = function (evt) {
                    console.log("CONNECTED");
                };
                websocket.onclose = function (evt) {
                    console.log("DISCONNECTED");
                };
                websocket.onmessage = function (evt) {
                    console.log( "Message received :", evt.data );
                    console.log( evt.data );
                };
                websocket.onerror = function (evt) {
                    console.log('ERROR: ' + evt.data);
                };
            } catch (exception) {
                console.log('ERROR: ' + exception);
            }

            var lastX, lastY, lastTime
            function handleMouseMove(e){
                websocket.send(JSON.stringify({x: e.clientX - lastX, y: e.clientY - lastY, t: e.timeStamp - lastTime}));
                lastX = e.clientX
                lastY = e.clientY
                lastTime = e.timeStamp
            }
            function handleTouchStart(e) {
                e.preventDefault()
                lastX = e.changedTouches[0].pageX
                lastY = e.changedTouches[0].pageY
                lastTime = e.timeStamp
            }
            function handleTouchMove(e) {
                var t = e.changedTouches[0]
                websocket.send(JSON.stringify({x: t.pageX - lastX, y: t.pageY - lastY, t: e.timeStamp - lastTime}));
                lastX = t.pageX
                lastY = t.pageY
                lastTime = e.timeStamp
            }
            document.body.addEventListener('mousemove', handleMouseMove)
            document.body.addEventListener("touchstart", handleTouchStart);
            document.body.addEventListener("touchmove", handleTouchMove);
        </script>
    </body>
</html>
